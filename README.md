As the application demand for network determinism and reliability grows, researchers are committed to developing higher-level protocols or entirely new network protocol stacks. Real-world testing, while most convincing, faces challenges of scale and budget, making simulation experiments an important pre-step. However, compatibility issues between simulation code and real devices limit its direct application. Meanwhile, the code developed on real devices needs to be verified by building a large number of test cases. To address this issue, this paper proposes a lightweight code reusability framework to realize the migration of protocol stack code across multiple emulation software and operating systems.

![Figure 1 Code Reusability Framework](https://github.com/user-attachments/assets/bc3c40df-2f2b-40bb-a899-015895f7ebda)
As shown in Figure 1, this is the module block diagram of cross-platform middleware. The whole middleware consists of the following parts: platform layer, platform-independent layer, protocol layer and application layer. In order to make this framework scalable, different adapters are designed for different platforms. The adapters encapsulate clock-related interfaces and packet transceiver-related interfaces and provide standard interfaces to the PIL (Platform Independence Layer) layer. This allows the PIL layer to design the PILTimer and PIL API based on these standard interfaces, where the PIL API completes the data sending and receiving, the PILTimer maintains a list of discrete events and provides a unified timer-related functions for the upper layer, and the error-adding module provides the ability to add errors to the data.On top of the PIL layer is the protocol layer, which utilizes the relevant APIs in PIL to complete the relevant operations required by the network protocols, such as The protocol layer is above the PIL layer, which utilizes the relevant APIs of PIL to complete the relevant operations required by the network protocols, such as setting the timeout timer of the protocol through the interface provided by the PIL layer. In order to facilitate protocol management and data transfer between protocols, we maintain a protocol tree in the protocol layer and define a series of interfaces for protocol tree expansion and protocol management. The application layer realizes the configuration management of basic applications and protocols.

If you want to use CRP, Contact email:pengyifei@std.uestc.edu.cn
